// Smritipat Reception Hall Management System - Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// User Management & Authentication
// ============================================

enum UserRole {
  ADMIN
  MANAGER
  ACCOUNTANT
  VIEWER
}

model User {
  id           String    @id @default(cuid())
  name         String
  email        String    @unique
  passwordHash String
  role         UserRole  @default(VIEWER)
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  bookingsCreated Booking[]
  expensesCreated Expense[]
  auditLogs       AuditLog[]

  @@index([email])
  @@map("users")
}

// ============================================
// Hall Management
// ============================================

enum FloorType {
  GROUND
  FIRST
  BOTH
}

model Hall {
  id        String    @id @default(cuid())
  name      String
  floor     FloorType @default(GROUND)
  capacity  Int
  baseRent  Decimal   @db.Decimal(10, 2)
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  bookings Booking[]

  @@map("halls")
}

// ============================================
// Booking Management
// ============================================

enum BookingStatus {
  INQUIRY
  TENTATIVE
  CONFIRMED
  COMPLETED
  CANCELLED
}

model Booking {
  id             String        @id @default(cuid())
  hallId         String
  customerName   String
  customerPhone  String
  customerEmail  String?
  eventType      String
  eventDate      DateTime      @db.Date
  startTime      DateTime      @db.Time
  endTime        DateTime      @db.Time
  status         BookingStatus @default(INQUIRY)
  baseRent       Decimal       @db.Decimal(10, 2)
  discountAmount Decimal       @default(0) @db.Decimal(10, 2)
  taxRate        Decimal       @default(0.18) @db.Decimal(5, 4)
  notes          String?       @db.Text
  createdByUserId String
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  // Relations
  hall           Hall            @relation(fields: [hallId], references: [id])
  createdBy      User            @relation(fields: [createdByUserId], references: [id])
  bookingCharges BookingCharge[]
  payments       Payment[]
  expenses       Expense[]

  @@index([hallId])
  @@index([eventDate])
  @@index([status])
  @@index([createdByUserId])
  @@map("bookings")
}

// ============================================
// Additional Charges
// ============================================

enum ChargeType {
  AC
  DECORATION
  SOUND
  CATERING
  CLEANING
  GENERATOR
  OTHER
}

model BookingCharge {
  id          String     @id @default(cuid())
  bookingId   String
  type        ChargeType
  description String
  amount      Decimal    @db.Decimal(10, 2)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@map("booking_charges")
}

// ============================================
// Payments
// ============================================

enum PaymentType {
  ADVANCE
  FINAL
  REFUND
}

enum PaymentMethod {
  CASH
  CARD
  BANK_TRANSFER
  UPI
  OTHER
}

model Payment {
  id            String        @id @default(cuid())
  bookingId     String
  amount        Decimal       @db.Decimal(10, 2)
  type          PaymentType
  paymentMethod PaymentMethod
  paymentDate   DateTime      @db.Date
  reference     String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([paymentDate])
  @@map("payments")
}

// ============================================
// Expenses
// ============================================

enum ExpenseCategory {
  ELECTRICITY
  WATER
  SALARY
  REPAIR_MAINTENANCE
  CLEANING
  DECORATION_MATERIAL
  CATERING_MATERIAL
  GENERATOR_FUEL
  RENT
  MISC
}

model Expense {
  id               String          @id @default(cuid())
  category         ExpenseCategory
  relatedBookingId String?
  description      String
  amount           Decimal         @db.Decimal(10, 2)
  expenseDate      DateTime        @db.Date
  createdByUserId  String
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  // Relations
  relatedBooking Booking? @relation(fields: [relatedBookingId], references: [id], onDelete: SetNull)
  createdBy      User     @relation(fields: [createdByUserId], references: [id])

  @@index([category])
  @@index([expenseDate])
  @@index([relatedBookingId])
  @@index([createdByUserId])
  @@map("expenses")
}

// ============================================
// System Settings
// ============================================

model SystemSettings {
  id             String   @id @default(cuid())
  currencySymbol String   @default("â‚¹")
  defaultTaxRate Decimal  @default(0.18) @db.Decimal(5, 4)
  defaultHallId  String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("system_settings")
}

// ============================================
// Audit Logs
// ============================================

enum LogLevel {
  INFO
  WARN
  ERROR
}

enum LogAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  EXPORT
  VIEW
}

model AuditLog {
  id          String    @id @default(cuid())
  userId      String?
  action      LogAction
  entity      String // e.g., "booking", "user", "expense"
  entityId    String?
  level       LogLevel  @default(INFO)
  message     String
  metadata    Json? // Additional context data
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime  @default(now())

  // Relations
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([entity])
  @@index([action])
  @@index([level])
  @@index([createdAt])
  @@map("audit_logs")
}
